# Markov Chain Monte Carlo for Unconditional Molecule Generation

<!-- [![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://github.com/MinkaiXu/GeoLDM/blob/main/LICENSE)
[![ArXiv](http://img.shields.io/badge/cs.LG-arXiv%3A2305.01140-B31B1B.svg)](https://arxiv.org/abs/2305.01140) -->

<!-- [[Code](https://github.com/MinkaiXu/GeoLDM)] -->

![cover](equivariant_diffusion/pgm_final_picture.png)

This work aims to leverage MCMC to sample novel, drug-like ligands based on molecules in the QM9 dataset. We train a graph-based molecular diffusion model, GeoLDM, and implement a sampling technique known as continuous walk-jump sampling (cWJS) which has previously proven effective for unconditional ligand generation on other molecular representations. Applying this variant of sampling allows us to streamline the training procedure of GeoLDM by reducing the number of diffusion steps and simplifying the noise schedule. By training and sampling based on QM9, we can compare the ligands generated by our graph-based cWJS method to both a graph-based dif-
fusion method, GeoLDM, and a voxel-based cWJS method, VoxMol.

## Environment

Install the required packages from `requirements.txt`. A simplified version of the requirements can be found [here](https://github.com/ehoogeboom/e3_diffusion_for_molecules/blob/main/requirements.txt).

## Train the GeoLDM

### For QM9

```python main_qm9.py --n_epochs 3000 --n_stability_samples 1000 --diffusion_noise_schedule polynomial_2 --diffusion_noise_precision 1e-5 --diffusion_steps 1000 --diffusion_loss_type l2 --batch_size 64 --nf 256 --n_layers 9 --lr 1e-4 --normalize_factors [1,4,10] --test_epochs 20 --ema_decay 0.9999 --train_diffusion --trainable_ae --latent_nf 1 --exp_name geoldm_qm9```

## Evaluate the GeoLDM

To analyze the sample quality of molecules:

```python eval_analyze.py --model_path outputs/$exp_name --n_samples 10_000```

To visualize some molecules:

```python eval_sample.py --model_path outputs/$exp_name --n_samples 10_000```

## Acknowledgements

This repo is built upon the previous work [EDM](https://arxiv.org/abs/2203.17003). Thanks to the authors for their great work!
